<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rekap Peserta Real-time</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#fff;--card:#fff;--line:#e5e7eb;--text:#111827;
      --subtle:#6b7280;--accent:#3b82f6;--r:6px;--sh:0 2px 6px rgba(0,0,0,.28);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;font-size:10px;background:transparent;padding:0;}
    .card{width:100%;max-width:850px;margin:auto;background:var(--card);border-radius:var(--r);box-shadow:var(--sh);padding:5px}
    input{width:100%;padding:5px 8px;border:1px solid var(--line);border-radius:var(--r);font-size:11px}
    table{width:100%;border-collapse:collapse;font-size:10px}
    th,td{padding:4px 5px;border:1px solid var(--line)}
    th{background:#f9fafb;position:sticky;top:0;z-index:1;font-weight:500}
    tr.new td{background:#d1ffd1;animation:f 1s ease forwards}
    @keyframes f{to{background:transparent}}
    .pg{display:flex;justify-content:space-between;margin-top:6px;font-size:10px}
    .pg button{padding:3px 6px;border:1px solid var(--line);background:#fff;border-radius:var(--r)}
    .pg button:disabled{opacity:.5}
    @media(max-width:360px){body{font-size:9px}th,td{padding:3px 4px}}
  </style>
</head>
<body>
  <div class="card">
    <h2><strong>LETAK KANTOR, PIC, NO REK</strong></h2>
    <input id="q" placeholder="Cari Lokasi Kantor Pos / PIC" autocomplete="off">
    <table id="t"><thead></thead><tbody></tbody></table>
    <div class="pg" id="pg"></div>
  </div>

  <script>
    const URL  = 'https://script.google.com/macros/s/AKfycby-9FgPs6Ug-g6WdddTpRnsRwo547iwwDT4yVZYg8FPWB3kMd4CABdvs89EtOq-Ksh9YA/exec';
    const ROW  = 5;
    const POLL = 5000;
    const FADE = 1200;

    let raw=[], stamp='', page=1, q='', pageCache;

    const $=s=>document.querySelector(s);
    const el=(t,h)=>{const e=document.createElement(t);e.innerHTML=h;return e;};

    /*-----------  fungsi render  -----------*/
    function render(){
      const qq=$('#q').value.trim().toLowerCase();
      if(qq===q && raw.length && page===pageCache) return;
      q=qq; pageCache=page;

      const filt=raw.filter((r,i)=>!i||r.join(' ').toLowerCase().includes(q));
      const head=filt[0]||[], body=filt.slice(1);
      const pages=Math.ceil(body.length/ROW)||1;
      if(page>pages) page=pages;
      const start=(page-1)*ROW, end=start+ROW, slice=body.slice(start,end);

      /* indeks kolom yang akan ditampilkan: 0,1,2,4,5 (3 disembunyikan) */
      const visibleCols=[0,1,2,4,5];

      /* buat header hanya sekali */
      if($('#t thead').children.length===0){
        $('#t thead').appendChild(
          el('tr', visibleCols.map(i=>`<th>${head[i]||''}</th>`).join(''))
        );
      }

      const tbody=$('#t tbody');
      const nowIds=slice.map(r=>r.join(''));
      const oldIds=[...tbody.rows].map(r=>r.dataset.key);

      /* hapus baris yg sudah tidak ada */
      [...tbody.rows].forEach(tr=>{
        if(!nowIds.includes(tr.dataset.key)) tbody.removeChild(tr);
      });

      /* tambah / update baris */
      slice.forEach((row,i)=>{
        const key=row.join('');
        let tr=tbody.rows[i];
        if(!tr||tr.dataset.key!==key){
          tr=el('tr',''); tr.dataset.key=key; tr.className='new';

          visibleCols.forEach(idx=>{
            const c=row[idx]||'';
            /* ===>>> kolom 4 (indeks 4) diganti ðŸ“ž jika berisi URL <<<=== */
            if(idx===4 && c && (c.startsWith('http://')||c.startsWith('https://'))){
              const a=document.createElement('a');
              a.href=c; a.target='_blank'; a.style.textDecoration='none'; a.style.color='var(--accent)';
              a.innerHTML='ðŸ“ž';
              const td=document.createElement('td');
              td.appendChild(a);
              tr.appendChild(td);
            }else{
              tr.appendChild(el('td',c));
            }
          });

          tbody.insertBefore(tr, tbody.children[i]||null);
          setTimeout(()=>tr.classList.remove('new'),FADE);
        }
      });

      /* pager */
      $('#pg').innerHTML=
        `<button ${page===1?'disabled':''}>Prev</button>
         <span>${page}/${pages}</span>
         <button ${page===pages?'disabled':''}>Next</button>`;
      $('#pg').onclick=e=>{
        if(e.target.tagName!=='BUTTON') return;
        page+=e.target.textContent==='Next'?1:-1; render();
      };
    }

    /*-----------  load data  -----------*/
    async function load(){
      try{
        const res=await fetch(URL);
        if(res.status===304) return;
        const arr=await res.json();
        const s=JSON.stringify(arr);
        if(s===stamp) return;
        stamp=s; raw=arr; page=1; render();
      }catch(e){console.error(e);}
    }

    $('#q').addEventListener('input',()=>{page=1; render();});
    load(); setInterval(load,POLL);
  </script>
</body>

<body>
<br>
<h2><strong><center>1 KEPING MATERAI = Rp. 10.000,00</center><strong></h2>
</body>

</html>
